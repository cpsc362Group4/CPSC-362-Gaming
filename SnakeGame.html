<!--
This was created using AI but will be scaled down and back up through user efforts. 
We used AI to speed up Progress.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Snake ‚Äî Single File</title>
    <style>
      :root {
        --bg: #0b1220;
        --panel: #11182a;
        --grid: #1a2440;
        --snake: #7bffb7;
        --head: #6aa6ff;
        --food: #ff6a8a;
        --ink: #e9eefc;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(
          80% 80% at 50% 0%,
          #0e1a34 0%,
          var(--bg) 70%
        );
        color: var(--ink);
        font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      }
      .wrap {
        background: linear-gradient(180deg, #0f1a31 0%, #0b1326 100%);
        border-radius: 18px;
        padding: 16px;
        width: min(92vw, 520px);
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.45),
          inset 0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      h1 {
        margin: 0 0 8px;
        font-size: clamp(20px, 3.2vw, 28px);
      }
      .hud {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .tag {
        background: #162242;
        color: #cfe0ff;
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 700;
      }
      canvas {
        width: 100%;
        aspect-ratio: 1/1;
        background: var(--panel);
        border-radius: 14px;
        box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.06);
      }
      .controls {
        margin-top: 10px;
        display: grid;
        gap: 8px;
        grid-template-columns: repeat(3, 1fr);
      }
      .btn {
        user-select: none;
        cursor: pointer;
        border: 0;
        border-radius: 12px;
        padding: 10px 12px;
        font-weight: 800;
        background: #1a2343;
        color: #dbe7ff;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .btn:active {
        transform: scale(0.98);
      }
      @media (min-width: 540px) {
        .controls {
          display: none;
        }
      } /* hide touch arrows on larger screens */
      .hint {
        opacity: 0.8;
        font-size: 0.9rem;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Snake</h1>
      <div class="hud">
        <div class="tag">Score: <span id="score">0</span></div>
        <div class="tag">Best: <span id="best">0</span></div>
        <button class="btn" id="pauseBtn">Pause</button>
      </div>
      <canvas
        id="board"
        width="420"
        height="420"
        aria-label="Snake game area"
      ></canvas>
      <div class="controls" aria-hidden="false">
        <button class="btn" id="up">‚¨ÜÔ∏è</button>
        <button class="btn" id="restart">üîÑ</button>
        <button class="btn" id="right">‚û°Ô∏è</button>
        <button class="btn" id="left">‚¨ÖÔ∏è</button>
        <button class="btn" id="down">‚¨áÔ∏è</button>
        <button class="btn" id="pause">‚èØ</button>
      </div>
      <p class="hint">
        Controls: Arrow keys / WASD. Space to pause. Enter to restart.
      </p>
    </div>

    <script>
      (() => {
        // --- Config ---
        const gridSize = 21; // number of cells per side (square)
        const speedFPS = 9; // moves per second
        const growBy = 1; // segments per food
        const board = document.getElementById("board");
        const ctx = board.getContext("2d");
        const cell = board.width / gridSize;
        const scoreEl = document.getElementById("score");
        const bestEl = document.getElementById("best");
        const pauseBtn = document.getElementById("pauseBtn");

        // Touch buttons
        const tUp = document.getElementById("up"),
          tDown = document.getElementById("down"),
          tLeft = document.getElementById("left"),
          tRight = document.getElementById("right"),
          tPause = document.getElementById("pause"),
          tRestart = document.getElementById("restart");

        // --- State ---
        let snake, dir, nextDir, food, score, best, paused, dead, acc, stepMs;
        function reset() {
          snake = [
            { x: Math.floor(gridSize / 2), y: Math.floor(gridSize / 2) },
          ];
          dir = { x: 1, y: 0 };
          nextDir = { ...dir };
          score = 0;
          paused = false;
          dead = false;
          acc = 0;
          stepMs = 1000 / speedFPS;
          placeFood();
          scoreEl.textContent = score;
        }
        best = Number(localStorage.getItem("snake_best") || 0);
        bestEl.textContent = best;
        reset();

        function randInt(n) {
          return Math.floor(Math.random() * n);
        }
        function placeFood() {
          do {
            food = { x: randInt(gridSize), y: randInt(gridSize) };
          } while (snake.some((s) => s.x === food.x && s.y === food.y));
        }

        // --- Input ---
        const keyMap = {
          ArrowUp: { x: 0, y: -1 },
          KeyW: { x: 0, y: -1 },
          ArrowDown: { x: 0, y: 1 },
          KeyS: { x: 0, y: 1 },
          ArrowLeft: { x: -1, y: 0 },
          KeyA: { x: -1, y: 0 },
          ArrowRight: { x: 1, y: 0 },
          KeyD: { x: 1, y: 0 },
        };
        addEventListener("keydown", (e) => {
          if (e.code === "Space") {
            paused = !paused;
            return;
          }
          if (e.code === "Enter") {
            if (dead) reset();
            return;
          }
          const v = keyMap[e.code];
          if (!v) return;
          // prevent reversing direction
          if (snake.length > 1 && v.x === -dir.x && v.y === -dir.y) return;
          nextDir = v;
        });

        function tapDir(v) {
          if (snake.length > 1 && v.x === -dir.x && v.y === -dir.y) return;
          nextDir = v;
        }
        tUp?.addEventListener("click", () => tapDir({ x: 0, y: -1 }));
        tDown?.addEventListener("click", () => tapDir({ x: 0, y: 1 }));
        tLeft?.addEventListener("click", () => tapDir({ x: -1, y: 0 }));
        tRight?.addEventListener("click", () => tapDir({ x: 1, y: 0 }));
        tPause?.addEventListener("click", () => (paused = !paused));
        tRestart?.addEventListener("click", () => reset());
        pauseBtn.addEventListener("click", () => (paused = !paused));

        // --- Game Loop ---
        let last = performance.now();
        function loop(now) {
          const dt = now - last;
          last = now;
          if (!paused && !dead) {
            acc += dt;
            while (acc >= stepMs) {
              step();
              acc -= stepMs;
            }
          }
          draw();
          requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);

        function step() {
          dir = nextDir;
          const head = {
            x: (snake[0].x + dir.x + gridSize) % gridSize,
            y: (snake[0].y + dir.y + gridSize) % gridSize,
          };
          // self hit?
          if (snake.some((s) => s.x === head.x && s.y === head.y)) {
            dead = true;
            best = Math.max(best, score);
            localStorage.setItem("snake_best", String(best));
            bestEl.textContent = best;
            return;
          }
          snake.unshift(head);
          // food?
          if (head.x === food.x && head.y === food.y) {
            score += 1;
            scoreEl.textContent = score;
            for (let i = 0; i < growBy - 1; i++)
              snake.push({ ...snake[snake.length - 1] });
            placeFood();
          } else {
            snake.pop();
          }
        }

        // --- Render ---
        function draw() {
          // bg grid
          ctx.fillStyle = getComputedStyle(
            document.documentElement
          ).getPropertyValue("--panel");
          ctx.fillRect(0, 0, board.width, board.height);
          ctx.fillStyle = getComputedStyle(
            document.documentElement
          ).getPropertyValue("--grid");
          for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
              if ((i + j) % 2 === 0)
                ctx.fillRect(i * cell, j * cell, cell, cell);
            }
          }
          // food
          ctx.fillStyle = getComputedStyle(
            document.documentElement
          ).getPropertyValue("--food");
          roundRect(
            food.x * cell + 2,
            food.y * cell + 2,
            cell - 4,
            cell - 4,
            6
          );

          // snake
          const snakeColor = getComputedStyle(
            document.documentElement
          ).getPropertyValue("--snake");
          const headColor = getComputedStyle(
            document.documentElement
          ).getPropertyValue("--head");
          snake.forEach((s, idx) => {
            ctx.fillStyle = idx === 0 ? headColor : snakeColor;
            roundRect(s.x * cell + 2, s.y * cell + 2, cell - 4, cell - 4, 6);
          });

          if (paused || dead) {
            ctx.fillStyle = "rgba(0,0,0,.45)";
            ctx.fillRect(0, 0, board.width, board.height);
            ctx.fillStyle = "#e9eefc";
            ctx.font = "bold 28px system-ui";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(
              dead ? "Game Over ‚Äî Enter to Restart" : "Paused",
              board.width / 2,
              board.height / 2
            );
          }
        }

        function roundRect(x, y, w, h, r) {
          ctx.beginPath();
          ctx.moveTo(x + r, y);
          ctx.arcTo(x + w, y, x + w, y + h, r);
          ctx.arcTo(x + w, y + h, x, y + h, r);
          ctx.arcTo(x, y + h, x, y, r);
          ctx.arcTo(x, y, x + w, y, r);
          ctx.closePath();
          ctx.fill();
        }
      })();
    </script>
  </body>
</html>
